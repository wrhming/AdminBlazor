@namespace AdminBlazor
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage;
@inherits LayoutComponentBase
@inject ProtectedSessionStorage _sessionStorage
@inject NavigationManager _navigationManager

<AntDesign.ProLayout.BasicLayout Logo="@("https://gw.alipayobjects.com/zos/rmsportal/KDpgvguMpGfqaHPjicRK.svg")"
                                 MenuData="_menuData">
    <RightContentRender>

    </RightContentRender>
    <ChildContent>
        @Body
    </ChildContent>
    <FooterRender>
        <FooterView Copyright="2021 Ant Design Blazor" Links="Links"></FooterView>
    </FooterRender>
</AntDesign.ProLayout.BasicLayout>
<SettingDrawer />

@code
{
    [CascadingParameter]
    private Task<AuthenticationState> authenticationState { get; set; }

    private  MenuDataItem[] _menuData =
    {
        new MenuDataItem
        {
            Path = "/",
            Name = "welcome",
            Key = "welcome",
            Icon = "smile",
        },
        new MenuDataItem
        {
            Path = "/role/index",
            Name = "角色管理",
            Key = "role",
            Icon = "team",
        },
        new MenuDataItem
        {
            Path = "/user/index",
            Name = "用户管理",
            Key = "user",
            Icon = "user",
        }
    };


    private async Task<bool> IsInRole(string role)
    {
        var authState = await authenticationState;

        return authState.User.IsInRole(role);
    }

    protected override async Task OnInitializedAsync()
    {

        var userSessionStorageResult = await _sessionStorage.GetAsync<UserSession>("UserSession");
        if (userSessionStorageResult.Success == false || userSessionStorageResult.Value == null)
        {
            _navigationManager.NavigateTo("/user/login");
        }
    }


    public LinkItem[] Links { get; set; } =
    {
    };
}